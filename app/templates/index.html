<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{{ title }}</title>
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="/static/styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="logo">UM</div>
        <div>
          <h1>Uptime Monitor</h1>
          <p class="subtitle">Operational dashboard</p>
        </div>
      </div>
      <div class="status-pill" id="healthPill">
        <span class="dot"></span>
        <span id="healthText">Checking...</span>
      </div>
    </header>

    <main class="container">
      <section class="card">
        <div class="card-header">
          <h2>Monitors</h2>
          <button class="btn" id="refreshBtn" onclick="location.reload()">Refresh</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>URL</th>
                <th>Interval (s)</th>
                <th>Status</th>
                <th>Last Checked</th>
              </tr>
            </thead>
            <tbody>
              {% if monitors %}
                {% for monitor in monitors %}
                  <tr>
                    <td>{{ monitor.name }}</td>
                    <td><a href="{{ monitor.url }}" target="_blank" style="color: white;">{{ monitor.url }}</a></td>
                    <td>{{ monitor.interval_seconds }}</td>
                    <td>
                      {% if monitor.status == "up" %}
                        <span style="color:green;">&#9679; Up</span>
                      {% elif monitor.status == "down" %}
                        <span style="color:red;">&#9679; Down</span>
                      {% else %}
                        <span style="color:gray;">&#9679; Pending</span>
                      {% endif %}
                    </td>
                    <td>
                      {{ monitor.last_checked if monitor.last_checked else "Never" }}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="muted">No monitors yet</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <div class="card-header">
          <h2>Quick Actions</h2>
        </div>
        <form class="form" id="createForm" method="post" action="/monitors" onsubmit="return submitForm(event)">
          <label>
            Name
            <input type="text" name="name" placeholder="Homepage" required />
          </label>
          <label>
            URL
            <input type="url" name="url" placeholder="https://example.com" required />
          </label>
          <label>
            Interval (seconds)
            <input type="number" name="interval_seconds" min="10" value="60" required />
          </label>
          <button class="btn primary" type="submit">Create Monitor</button>
          <p class="hint">Auto-refresh every 15 seconds.</p>
          <div id="formMessage" style="color: red; margin-top: 10px;"></div>
        </form>
      </section>
    </main>

    <footer class="footer">
      <span>© {{ title }} · {{ now().year if now else '' }}</span>
    </footer>
    <script>
      // Optional: AJAX form submission for better UX
      async function submitForm(event) {
        event.preventDefault();
        const form = event.target;
        const data = {
          name: form.name.value,
          url: form.url.value,
          interval_seconds: form.interval_seconds.value
        };
        const messageDiv = document.getElementById('formMessage');
        messageDiv.textContent = '';
        try {
          const response = await fetch('/monitors', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
          });
          if (response.ok) {
            messageDiv.style.color = 'green';
            messageDiv.textContent = 'Monitor created!';
            setTimeout(() => location.reload(), 1000);
          } else {
            const result = await response.json();
            messageDiv.style.color = 'red';
            messageDiv.textContent = result.detail || 'Error creating monitor.';
          }
        } catch (err) {
          messageDiv.style.color = 'red';
          messageDiv.textContent = 'Network error.';
        }
        return false;
      }
    </script>
    <script src="/static/app.js"></script>
  </body>
</html>